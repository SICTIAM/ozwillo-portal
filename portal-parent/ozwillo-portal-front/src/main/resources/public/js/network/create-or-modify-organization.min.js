var CreateOrModifyOrganizationModal=React.createClass({displayName:"CreateOrModifyOrganizationModal",getInitialState:function(){return{organization:{},step:1}},componentDidMount:function(){$(this.getDOMNode()).on("shown.bs.modal",function(){$("input#contact_lastname",this).focus()})},open:function(organization){this.setState({organization:organization,step:1}),$(this.getDOMNode()).modal("show")},onStepChange:function(stepId){this.setState({step:stepId})},close:function(event){$(this.getDOMNode()).modal("hide")},closeAfterSuccess:function(){$(this.getDOMNode()).modal("hide"),this.props.successHandler()},render:function(){var modalTitle=(this.state.organization.exist?t("my.network.modify-org"):t("my.network.create-org"))+" "+this.state.organization.legal_name,modalSubTitle=t("my.network.organization.step")+" "+this.state.step+" / 2";return React.createElement("div",{className:"modal fade"},React.createElement("div",{className:"modal-dialog modal-lg"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close",onClick:this.close},"×"),React.createElement("h3",null,modalTitle),React.createElement("h4",null,modalSubTitle)),React.createElement(CreateOrModifyOrganizationForm,{ref:"form",successHandler:this.closeAfterSuccess,cancelHandler:this.close,organization:this.state.organization,step:this.state.step,onStepChange:this.onStepChange}))))}}),CreateOrModifyOrganizationForm=React.createClass({displayName:"CreateOrModifyOrganizationForm",getInitialState:function(){return{createOrUpdateError:{code:"",message:""}}},onNextTab:function(){this.refs.tab1.validateFields()&&this.props.onStepChange(2)},onPrevTab:function(){this.refs.tab2.validateFields()&&this.props.onStepChange(1)},onCreate:function(){if(this.refs.tab1.validateFields()&&this.refs.tab2.validateFields()){var finalOrganization=$.extend({},this.props.organization,this.refs.tab1.getFields());finalOrganization.exist?this.updateOrganization(finalOrganization):this.createOrganization(finalOrganization)}},createOrganization:function(organization){$.ajax({url:network_service+"/create-dc-organization",type:"post",contentType:"application/json",data:JSON.stringify(organization),success:function(data){data?this.props.successHandler():this.setState({createOrUpdateError:{code:"Invalid response",message:"The received response was empty"}})}.bind(this),error:function(xhr,status,err){this.setState({createOrUpdateError:{code:err,message:xhr.responseText}})}.bind(this)})},updateOrganization:function(organization){$.ajax({url:network_service+"/update-dc-organization",type:"post",contentType:"application/json",data:JSON.stringify(organization),success:function(data){data?this.props.successHandler():this.setState({createOrUpdateError:{code:"Invalid response",message:"The received response was empty"}})}.bind(this),error:function(xhr,status,err){this.setState({createOrUpdateError:{code:err,message:xhr.responseText}})}.bind(this)})},renderCreateOrUpdateError:function(){return""!==this.state.createOrUpdateError.code?React.createElement("label",{className:"error"},this.state.createOrUpdateError.message," (",this.state.createOrUpdateError.code,")"):void 0},render:function(){var organization=this.props.organization;return React.createElement("div",null,React.createElement("div",{className:"modal-body"},React.createElement("form",{id:"add-organization",onSubmit:this.onCreate,className:"form-horizontal"},React.createElement("div",{className:"form-horizontal"},React.createElement(Tab1,{id:"1",ref:"tab1",organization:organization,currentTab:this.props.step}),React.createElement(Tab2,{id:"2",ref:"tab2",organization:organization,currentTab:this.props.step})),this.renderCreateOrUpdateError())),React.createElement("div",{className:"modal-footer"},React.createElement(Button,{activeTab:this.props.step,onNext:this.onNextTab,onPrev:this.onPrevTab,onCancel:this.props.cancelHandler,onCreate:this.onCreate,inModification:organization.inModification})))}}),Button=React.createClass({displayName:"Button",renderStepSwitcherButton:function(){return 1===this.props.activeTab?React.createElement("button",{key:"next",className:"control btn btn-primary-inverse",onClick:this.props.onNext},t("ui.next")):React.createElement("button",{key:"prev",className:"control btn btn-primary-inverse",onClick:this.props.onPrev},t("ui.previous"))},renderCreateButton:function(){return 2===this.props.activeTab?this.props.inModification?React.createElement("button",{key:"success",className:"btn btn-primary",onClick:this.props.onCreate},t("ui.edit")):React.createElement("button",{key:"success",className:"btn btn-primary",onClick:this.props.onCreate},t("my.network.create")):void 0},render:function(){return React.createElement("div",null,React.createElement("button",{key:"cancel",className:"btn btn-default",onClick:this.props.onCancel},t("ui.cancel")),this.renderStepSwitcherButton(),this.renderCreateButton())}}),Field=React.createClass({displayName:"Field",propTypes:{name:React.PropTypes.string.isRequired,labelClassName:React.PropTypes.string,divClassName:React.PropTypes.string,error:React.PropTypes.bool,isRequired:React.PropTypes.bool},renderLabel:function(htmlFor,class_name,label,isRequired){var cn=isRequired?React.createElement("label",{className:"error"}," *"):"";return React.createElement("label",{htmlFor:htmlFor,className:class_name},label," ",cn)},render:function(){var labelClassName=this.props.labelClassName?this.props.labelClassName:"control-label col-sm-3";this.props.error&&(labelClassName+=" error");var divClassName=this.props.divClassName?this.props.divClassName:"col-sm-7";return React.createElement("div",{className:"form-group"},this.renderLabel(this.props.name,labelClassName,t("my.network.organization."+this.props.name),this.props.isRequired),React.createElement("div",{className:divClassName},this.props.children))}}),Tab1=React.createClass({displayName:"Tab1",getInitialState:function(){return{organization:{},contact_lastname:"",contact_name:"",errors:[]}},componentWillMount:function(){$.ajax({url:network_service+"/general-user-info",type:"get",contentType:"json",success:function(data){this.setState({contact_lastname:data.user_lastname,contact_name:data.user_name})}.bind(this),error:function(xhr,status,err){}.bind(this)})},componentWillReceiveProps:function(nextProps){this.setState({organization:nextProps.organization})},handleInputChange:function(event){var organization=this.state.organization;"contact_lastname"===event.target.id?this.setState({contact_lastname:event.target.value}):"contact_name"===event.target.id?this.setState({contact_name:event.target.value}):"city"===event.target.name?(organization.city_uri=event.target.value,event.added&&(organization.city=event.added.name)):organization[event.target.id]=event.target.value,this.setState({organization:organization})},validateFields:function(){var errors=[];return this.state.organization.inModification||""!==this.refs.contact_lastname.getDOMNode().value.trim()||errors.push("contact_lastname"),""===this.refs.street_and_number.getDOMNode().value.trim()&&errors.push("street_and_number"),this.state.organization.city&&""!==this.state.organization.city||errors.push("city"),(""===this.refs.zip.getDOMNode().value.trim()||-1===this.refs.zip.getDOMNode().value.trim().search(/^\d+$/))&&errors.push("zip"),""!==this.refs.cedex.getDOMNode().value.trim()&&-1===this.refs.cedex.getDOMNode().value.trim().search(/^\d+$/)&&errors.push("cedex"),errors.length>0&&errors.push("validation"),this.setState({errors:errors}),0==errors.length},getFields:function(){return this.props.organization.inModification?{}:{contact_lastName:this.refs.contact_lastname.getDOMNode().value.trim(),contact_name:this.refs.contact_name.getDOMNode().value.trim()}},renderGeneralErrorMessage:function(){return-1!=$.inArray("validation",this.state.errors)?React.createElement("label",{className:"error"},t("my.network.organization.invalid_fields")):void 0},renderProfileInformation:function(){return this.props.organization.inModification?void 0:React.createElement("fieldset",null,React.createElement("legend",null,t("my.network.organization.profile_information")),React.createElement(Field,{name:"contact_lastname",error:-1!=$.inArray("contact_lastname",this.state.errors),isRequired:!0},React.createElement("input",{className:"form-control",ref:"contact_lastname",id:"contact_lastname",type:"text",value:this.state.contact_lastname,onChange:this.handleInputChange})),React.createElement(Field,{name:"contact_name",error:-1!=$.inArray("contact_name",this.state.errors),isRequired:!0},React.createElement("input",{className:"form-control",ref:"contact_name",id:"contact_name",type:"text",value:this.state.contact_name,onChange:this.handleInputChange})))},render:function(){var className=1===this.props.currentTab?"":"hidden",country_uri=this.props.organization?this.props.organization.country_uri:"";return React.createElement("div",{id:"tab1",className:className},React.createElement("div",{className:"container-fluid"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-15"},this.renderProfileInformation(),React.createElement("fieldset",null,React.createElement("legend",null,t("my.network.organization.contact_information")),React.createElement(Field,{name:"street_and_number",error:-1!=$.inArray("street_and_number",this.state.errors),isRequired:!0},React.createElement("input",{className:"form-control",ref:"street_and_number",id:"street_and_number",type:"text",value:this.state.organization.street_and_number,onChange:this.handleInputChange})),React.createElement(Field,{name:"additional_address_field",error:-1!=$.inArray("additional_address_field",this.state.errors),isRequired:!1},React.createElement("input",{className:"form-control",ref:"additional_address_field",id:"additional_address_field",type:"text",value:this.state.organization.additional_address_field,onChange:this.handleInputChange})),React.createElement(Field,{name:"po_box",error:-1!=$.inArray("po_box",this.state.errors),isRequired:!1},React.createElement("input",{className:"form-control",ref:"po_box",id:"po_box",type:"text",value:this.state.organization.po_box,onChange:this.handleInputChange})),React.createElement(Field,{name:"city",error:-1!=$.inArray("city",this.state.errors),isRequired:!0},React.createElement(GeoSingleSelect2Component,{ref:"city",className:"form-control",name:"city",key:this.state.organization.city,urlResources:store_service+"/dc-cities",countryFilter:{country_uri:country_uri},onChange:this.handleInputChange,placeholder:this.state.organization.city})),React.createElement(Field,{name:"zip",divClassName:"col-sm-2",error:-1!=$.inArray("zip",this.state.errors),isRequired:!0},React.createElement("input",{className:"form-control",ref:"zip",id:"zip",type:"text",maxLength:6,value:this.state.organization.zip,onChange:this.handleInputChange})),React.createElement(Field,{name:"cedex",divClassName:"col-sm-2",error:-1!=$.inArray("cedex",this.state.errors),isRequired:!1},React.createElement("input",{className:"form-control",ref:"cedex",id:"cedex",type:"text",maxLength:3,value:this.state.organization.cedex,onChange:this.handleInputChange})))))),this.renderGeneralErrorMessage())}}),Tab2=React.createClass({displayName:"Tab2",getInitialState:function(){return{organization:{},errors:[]}},componentWillReceiveProps:function(nextProps){this.setState({organization:nextProps.organization})},handleInputChange:function(event){var organization=this.state.organization;"in_activity"===event.target.id?organization.in_activity=event.target.checked:"tax_reg_activity"===event.target.name?(organization.tax_reg_activity_uri=event.target.value,event.added&&(organization.tax_reg_activity=event.added.name)):"jurisdiction"===event.target.name?(organization.jurisdiction_uri=event.target.value,event.added&&(organization.jurisdiction=event.added.name)):organization[event.target.id]=event.target.value,this.setState({organization:organization})},validateFields:function(){var errors=[];return""===this.refs.legal_name.getDOMNode().value.trim()&&errors.push("legal_name"),"PUBLIC_BODY"!==this.state.organization.sector_type||this.state.organization.jurisdiction&&""!==this.state.organization.jurisdiction||errors.push("jurisdiction"),errors.length>0&&errors.push("validation"),this.setState({errors:errors}),0==errors.length},getFields:function(){return{}},getTaxRegLabels:function(){var tax_reg_num_label,tax_reg_official_id_label="",tax_reg_activity_label="",n=this.state.organization.country_uri?this.state.organization.country_uri.lastIndexOf("/"):-1,acronymCountry=n>0?this.state.organization.country_uri.substring(n+1):"";switch(acronymCountry){case"BG":tax_reg_num_label="tax_reg_num.bg",tax_reg_official_id_label="tax_reg_activity.bg";break;case"IT":tax_reg_num_label="tax_reg_num.it",tax_reg_official_id_label="tax_reg_activity.it";break;case"FR":tax_reg_num_label="tax_reg_num.fr",tax_reg_official_id_label="tax_reg_official_id.fr",tax_reg_activity_label="tax_reg_activity.fr";break;case"ES":tax_reg_num_label="tax_reg_num.es",tax_reg_official_id_label="tax_reg_activity.es";break;case"TR":tax_reg_num_label="tax_reg_num.tr",tax_reg_official_id_label="tax_reg_official_id.tr",tax_reg_activity_label="tax_reg_activity.tr";break;default:tax_reg_num_label="tax_reg_num.en"}return{tax_reg_num_label:tax_reg_num_label,tax_reg_official_id_label:tax_reg_official_id_label,tax_reg_activity_label:tax_reg_activity_label}},renderTaxRegOfficialId:function(tax_reg_official_id_label){return""!==tax_reg_official_id_label&&"PUBLIC_BODY"===this.state.organization.sector_type?React.createElement(Field,{name:tax_reg_official_id_label,error:-1!=$.inArray("tax_reg_official_id",this.props.errors),isRequired:!1},React.createElement("input",{className:"form-control",ref:"tax_reg_official_id",id:"tax_reg_official_id",type:"text",value:this.state.organization.tax_reg_official_id,onChange:this.handleInputChange})):void 0},renderJurisdiction:function(){return"PUBLIC_BODY"===this.state.organization.sector_type?React.createElement(Field,{name:"jurisdiction",error:-1!=$.inArray("jurisdiction",this.props.errors),isRequired:!0},React.createElement(GeoSingleSelect2Component,{ref:"jurisdiction",className:"form-control",name:"jurisdiction",key:this.state.organization.jurisdiction,urlResources:store_service+"/geographicalAreas",countryFilter:{country_uri:this.props.organization.country_uri},onChange:this.handleInputChange,placeholder:this.state.organization.jurisdiction})):void 0},renderGeneralErrorMessage:function(){return-1!=$.inArray("validation",this.state.errors)?React.createElement("label",{className:"error"},t("my.network.organization.invalid_fields")):void 0},render:function(){var className=2===this.props.currentTab?"":"hidden",taxRegNumLabels=this.getTaxRegLabels(),tax_reg_activity_uri_placeholder=this.state.organization.tax_reg_activity_uri?this.state.organization.tax_reg_activity_uri.substring(this.state.organization.tax_reg_activity_uri.lastIndexOf("/")+1):" ";return React.createElement("div",{id:"tab2",className:className},React.createElement("div",{className:"container-fluid"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-15"},React.createElement("fieldset",null,React.createElement("legend",null,t("my.network.organization.additional_information")),React.createElement(Field,{name:"legal_name",error:-1!=$.inArray("legal_name",this.props.errors),isRequired:!0},React.createElement("input",{className:"form-control",ref:"legal_name",id:"legal_name",type:"text",value:this.state.organization.legal_name,onChange:this.handleInputChange,disabled:this.state.organization.inModification||this.state.organization.exist})),React.createElement(Field,{name:taxRegNumLabels.tax_reg_num_label,error:-1!=$.inArray("tax_reg_num",this.props.errors),isRequired:!0},React.createElement("input",{className:"form-control",ref:"tax_reg_num",id:"tax_reg_num",type:"text",value:this.state.organization.tax_reg_num,disabled:!0})),React.createElement(Field,{name:"in_activity",error:-1!=$.inArray("in_activity",this.props.errors),isRequired:!1},React.createElement("input",{id:"in_activity",type:"checkbox",checked:this.state.organization.in_activity,onChange:this.handleInputChange})),React.createElement(Field,{name:"alt_name",error:-1!=$.inArray("alt_name",this.props.errors),isRequired:!1},React.createElement("input",{className:"form-control",ref:"alt_name",id:"alt_name",type:"text",value:this.state.organization.alt_name,onChange:this.handleInputChange})),React.createElement(Field,{name:"org_type",error:-1!=$.inArray("org_type",this.props.errors),isRequired:!1},React.createElement("input",{className:"form-control",ref:"org_type",id:"org_type",type:"text",value:this.state.organization.org_type,onChange:this.handleInputChange,placeholder:t("my.network.organization.org_type.placeholder")})),React.createElement(Field,{name:taxRegNumLabels.tax_reg_activity_label,class_name_div:"col-sm-3",isRequired:!1},React.createElement(GeoSingleSelect2Component,{ref:"tax_reg_activity",className:"form-control",name:"tax_reg_activity",key:this.props.organization.tax_reg_activity_uri,urlResources:store_service+"/dc-taxRegActivity",countryFilter:{country_uri:this.props.organization.country_uri},onChange:this.handleInputChange,minimumInputLength:2,placeholder:tax_reg_activity_uri_placeholder})),this.renderTaxRegOfficialId(taxRegNumLabels.tax_reg_official_id_label),this.renderJurisdiction(),React.createElement(Field,{name:"phone_number",error:-1!=$.inArray("phone_number",this.props.errors),isRequired:!1},React.createElement("input",{className:"form-control",ref:"phone_number",id:"phone_number",type:"text",value:this.state.organization.phone_number,onChange:this.handleInputChange})),React.createElement(Field,{name:"web_site",error:-1!=$.inArray("web_site",this.props.errors),isRequired:!1},React.createElement("input",{className:"form-control",ref:"web_site",id:"web_site",type:"text",value:this.state.organization.web_site,onChange:this.handleInputChange})),React.createElement(Field,{name:"email",error:-1!=$.inArray("email",this.props.errors),isRequired:!1},React.createElement("input",{className:"form-control",ref:"email",id:"email",type:"text",value:this.state.organization.email,onChange:this.handleInputChange})))))),this.renderGeneralErrorMessage())}});
