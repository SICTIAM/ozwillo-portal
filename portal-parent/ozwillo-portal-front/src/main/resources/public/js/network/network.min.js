var MyNetwork=React.createClass({displayName:"MyNetwork",openSearchOrgDialog:function(){this.refs.searchOrgDialog.open()},openCreateOrgDialog:function(organization){this.refs.createOrgDialog.open(organization)},reload:function(){this.refs.orgs.loadOrganizations()},render:function(){return React.createElement("div",null,React.createElement(SearchOrganizationModal,{ref:"searchOrgDialog",successHandler:this.openCreateOrgDialog}),React.createElement(CreateOrModifyOrganizationModal,{ref:"createOrgDialog",successHandler:this.reload}),React.createElement(SearchOrCreateHeader,{showDialog:this.openSearchOrgDialog}),React.createElement(OrganizationsList,{ref:"orgs"}))}}),SearchOrCreateHeader=React.createClass({displayName:"SearchOrCreateHeader",render:function(){return React.createElement("div",{className:"row add-organization-action"},React.createElement("a",{className:"btn btn-success pull-right",role:"button",href:"#",onClick:this.props.showDialog},t("my.network.add-organization")))}}),OrganizationsList=React.createClass({displayName:"OrganizationsList",getInitialState:function(){return{loading:!0,organizations:[]}},loadOrganizations:function(){$.ajax({url:network_service+"/organizations",type:"get",dataType:"json",success:function(data){this.setState({organizations:data,loading:!1})}.bind(this),error:function(xhr,status,err){this.setState({generalError:!0})}.bind(this)})},componentDidMount:function(){this.loadOrganizations()},render:function(){if(this.state.generalError)return React.createElement("p",{className:"alert alert-danger"},t("ui.general-error"));if(this.state.loading)return React.createElement("p",{className:"text-center"},React.createElement("i",{className:"fa fa-spinner fa-spin"})," ",t("ui.loading"));var reload=this.loadOrganizations,orgs=this.state.organizations.map(function(org){return React.createElement(Organization,{key:org.id,org:org,reload:reload})});return React.createElement("div",null,React.createElement("div",{className:"organizations"},orgs))}}),Organization=React.createClass({displayName:"Organization",getInitialState:function(){var state=this.props.org;return state.invite={email:"",errors:[]},state},componentDidUpdate:function(){"string"==typeof this.state.errorMessage&&this.refs.errorDialog.open()},updateInvitation:function(event){var state=this.state;state.invite.email=event.target.value,state.invite.errors=[],this.setState(state)},updateOrganization:function(organization,optionalOperation){var url=network_service+"/organization/"+organization.id;optionalOperation&&(url+="/"+optionalOperation),$.ajax({url:url,type:"post",contentType:"application/json",data:JSON.stringify(organization),success:function(data){var state=organization;"string"==typeof data&&0!==data.trim().length&&(state.errorMessage=data),this.props.org=state,this.setState(state)}.bind(this),error:function(xhr,status,err){this.props.reload()}.bind(this)})},invite:function(){var state=this.state;""==this.state.invite.email.trim()||-1==this.state.invite.email.indexOf("@")?(state.invite.errors=["email"],this.setState(state)):$.ajax({url:network_service+"/invite/"+this.props.org.id,type:"post",contentType:"application/json",data:JSON.stringify({email:state.invite.email}),success:function(data){var state=this.state;state.invite={email:"",errors:[]},this.refs.inviteDialog.close(),this.props.reload(),this.setState(state)}.bind(this),error:function(xhr,status,err){var state=this.state;state.invite.errors=["general"],this.setState(state)}.bind(this)})},openInvitation:function(){var state=this.state;state.invite={email:"",errors:[]},this.setState(state),this.refs.inviteDialog.open()},confirmLeave:function(){this.refs.leaveDialog.open()},removeInvitation:function(pMember){$.ajax({url:network_service+"/remove-invitation/"+this.props.org.id,type:"post",contentType:"application/json",data:JSON.stringify({id:pMember.id,email:pMember.email,etag:pMember.pending_membership_etag}),success:function(){this.props.reload()}.bind(this),error:function(xhr,status,err){}.bind(this)})},leave:function(){$.ajax({url:network_service+"/leave",type:"post",contentType:"application/json",data:JSON.stringify({organization:this.props.org.id}),success:function(){this.props.reload()}.bind(this),error:function(xhr,status,err){}.bind(this)}),this.refs.leaveDialog.close()},showInformation:function(){this.refs.infoDialog.open()},confirmTrash:function(){this.refs.confirmTrashDialog.open()},trash:function(){var org=this.state;org.status="DELETED",this.updateOrganization(org,"set-status"),this.refs.confirmTrashDialog.close()},confirmUntrash:function(){this.refs.confirmUntrashDialog.open()},untrash:function(){var org=this.state;org.status="AVAILABLE",this.updateOrganization(org,"set-status"),this.refs.confirmUntrashDialog.close()},closeErrorDialog:function(){var state=this.state;state.errorMessage=null,this.setState(state),this.props.reload()},removeMember:function(member){return function(event){event&&event.preventDefault();var org=this.props.org;org.members=org.members.filter(function(m){return m.id!=member.id}),this.updateOrganization(org)}.bind(this)},updateMember:function(member){var org=this.props.org;for(var i in org.members)if(org.members[i].id==member.id){org.members[i].admin=member.admin;break}this.updateOrganization(org)},renderMembers:function(){if(this.props.org.admin){var remove=this.removeMember,updateMember=this.updateMember,members=this.props.org.members.map(function(member){return React.createElement(Member,{key:member.id,member:member,remove:remove,updateMember:updateMember})});return members}return this.props.org.members.map(function(member){return React.createElement(ReadOnlyMember,{key:member.id,member:member})})},renderPendingMemberships:function(){if(this.props.org.admin){var removeInvitation=this.removeInvitation,pendingMemberships=this.props.org.pendingMemberships.map(function(pMember){return React.createElement(PendingMembership,{key:pMember.id,pMember:pMember,removeInvitation:removeInvitation})});return pendingMemberships}},render:function(){var buttons=[],dialogs=[];dialogs.push(React.createElement(Modal,{ref:"errorDialog",infobox:!0,onClose:this.closeErrorDialog,buttonLabels:{ok:t("ui.close")},title:t("my.network.information")},this.state.errorMessage));var membersList=this.renderMembers(),pendingMembershipList=this.renderPendingMemberships();if("DELETED"===this.props.org.status){var byDeleteRequesterOnDate=t("my.network.by")+" "+this.props.org.status_change_requester_label+" ("+moment(this.props.org.status_changed)+")";if(buttons.push(React.createElement("span",{key:"untrashTtl",style:{color:"red",fontStyle:"Italic",marginLeft:"5px",marginRight:"5px"},title:byDeleteRequesterOnDate},t("my.network.will-be-deleted")," ",moment(this.props.org.deletion_planned).fromNow())),this.props.org.admin){buttons.push(React.createElement("a",{key:"confirmUntrash",className:"btn btn-danger",onClick:this.confirmUntrash},t("ui.cancel"),"..."));var confirmUntrashTitle=t("my.network.confirm-untrash.title")+" "+this.props.org.name;dialogs.push(React.createElement(Modal,{ref:"confirmUntrashDialog",title:confirmUntrashTitle,successHandler:this.untrash,buttonLabels:{cancel:t("ui.cancel"),save:t("ui.confirm")}},t("my.network.confirm-untrash.body")))}}else{var buttons=[React.createElement("a",{key:"info",className:"btn btn-primary-inverse",onClick:this.showInformation},t("my.network.information"))],dialogs=[React.createElement(LeaveDialog,{ref:"leaveDialog",onSubmit:this.leave}),React.createElement(InformationDialog,{ref:"infoDialog",org:this.props.org,onUpdate:this.props.reload})];if(this.props.org.admin){1!=this.props.org.members.filter(function(m){return m.admin}).length&&buttons.push(React.createElement("a",{key:"leave",className:"btn btn-warning-inverse",onClick:this.confirmLeave},t("my.network.leave"))),buttons.push(React.createElement("a",{key:"invite",className:"btn btn-success-inverse",onClick:this.openInvitation},t("my.network.invite"))),buttons.push(React.createElement("a",{key:"confirmTrash",className:"btn btn-danger",onClick:this.confirmTrash},t("ui.delete"),"...")),dialogs.push(React.createElement(InviteDialog,{ref:"inviteDialog",admin:this.props.org.admin,onSubmit:this.invite,onChange:this.updateInvitation,email:this.state.invite.email,errors:this.state.invite.errors}));var confirmTrashTitle=t("my.network.confirm-trash.title")+" "+this.props.org.name;dialogs.push(React.createElement(Modal,{ref:"confirmTrashDialog",title:confirmTrashTitle,successHandler:this.trash,buttonLabels:{cancel:t("ui.cancel"),save:t("ui.confirm")}},t("my.network.confirm-trash.body")))}else buttons.push(React.createElement("a",{key:"leave",className:"btn btn-warning-inverse",onClick:this.confirmLeave},t("my.network.leave")))}return React.createElement("div",{className:"standard-form"},dialogs,React.createElement("div",{className:"row form-table-header"},React.createElement("div",{className:"col-sm-6"},React.createElement("span",{title:this.props.org.id},this.props.org.name)),React.createElement("div",{className:"col-sm-6"},buttons)),membersList,pendingMembershipList)}}),PendingMembership=React.createClass({displayName:"PendingMembership",getInitialState:function(){return{pMember:this.props.pMember}},renderUserTypeInvitation:function(){var admin=this.state.pMember.admin;return admin?t("my.network.admin"):t("my.network.user")},removeMembershipInvitation:function(event){event.preventDefault(),this.props.removeInvitation(this.state.pMember)},render:function(){var pMember=this.state.pMember,actions=React.createElement("div",{className:"col-sm-2 col-sm-offset-1"},React.createElement("a",{className:"lnk remove",href:"#",onClick:this.removeMembershipInvitation},React.createElement("i",{className:"fa fa-trash"}),t("ui.delete")));return React.createElement("div",{key:pMember.id,className:"row form-table-row-italics"},React.createElement("div",{className:"col-sm-4"},pMember.email),React.createElement("div",{className:"col-sm-4"},t("my.network.organization.pending-invitation")),actions)}}),Member=React.createClass({displayName:"Member",getInitialState:function(){return{edit:!1,member:this.props.member}},toggleEdit:function(event){null!=event&&event.preventDefault(),this.state.edit?this.setState({edit:!1,member:JSON.parse(JSON.stringify(this.props.member))}):this.setState({edit:!0,member:JSON.parse(JSON.stringify(this.props.member))})},save:function(event){event.preventDefault(),this.props.updateMember(this.state.member),this.toggleEdit(null)},renderAdmin:function(){var admin=this.state.member.admin,edit=this.state.edit;return edit?React.createElement("div",null,React.createElement("input",{className:"switch",type:"checkbox",checked:admin,onChange:function(){var state=this.state;state.member.admin=!admin,this.setState(state)}.bind(this)}),React.createElement("label",null,admin?t("my.network.admin"):t("my.network.user"))):admin?t("my.network.admin"):t("my.network.user")},render:function(){var member=this.state.member,remove=this.props.remove,toggleEdit=this.toggleEdit,save=this.save,actions=null;member.self||(actions=this.state.edit?React.createElement("div",{className:"col-sm-4 col-sm-offset-1"},React.createElement("a",{className:"lnk accept",href:"#",onClick:save},React.createElement("i",{className:"fa fa-check"}),t("ui.save")),React.createElement("a",{className:"lnk cancel",href:"#",onClick:toggleEdit},React.createElement("i",{className:"fa fa-times"}),t("ui.cancel"))):React.createElement("div",{className:"col-sm-4 col-sm-offset-1"},React.createElement("a",{className:"lnk edit",href:"#",onClick:toggleEdit},React.createElement("i",{className:"fa fa-pencil"}),t("ui.edit")),React.createElement("a",{className:"lnk remove",href:"#",onClick:remove(member)},React.createElement("i",{className:"fa fa-trash"}),t("ui.remove"))));var adminStatus=this.renderAdmin();return React.createElement("div",{key:member.id,className:"row form-table-row"},React.createElement("div",{className:"col-sm-3"},member.name),React.createElement("div",{className:"col-sm-3"},adminStatus),actions)}}),ReadOnlyMember=React.createClass({displayName:"ReadOnlyMember",render:function(){return React.createElement("div",{key:this.props.member.id,className:"row form-table-row"},React.createElement("div",{className:"col-sm-3"},this.props.member.name),React.createElement("div",{className:"col-sm-3"},this.props.member.self?t("my.network.user"):t("my.network.admin")))}}),InviteDialog=React.createClass({displayName:"InviteDialog",open:function(){this.refs.modal.open()},close:function(){this.refs.modal.close()},componentDidMount:function(){this.refs.modal&&$(this.refs.modal.getDOMNode()).on("shown.bs.modal",function(){$("input",this).first().focus()})},render:function(){if(this.props.admin){var inviteButtonLabels={save:t("my.network.invite"),cancel:t("ui.cancel")},labelClassName=-1==$.inArray("email",this.props.errors)?"col-sm-4":"col-sm-4 error",generalError=-1!=$.inArray("general",this.props.errors)?React.createElement("p",{className:"alert alert-danger",role:"alert"},t("ui.general-error")):null;return React.createElement(Modal,{ref:"modal",title:t("my.network.invite"),successHandler:this.props.onSubmit,buttonLabels:inviteButtonLabels},React.createElement("form",{className:"form-horizontal",onSubmit:this.props.onSubmit},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"email",className:labelClassName},t("my.network.email")),React.createElement("div",{className:"col-sm-8"},React.createElement("input",{className:"form-control",id:"email",type:"text",value:this.props.email,onChange:this.props.onChange,placeholder:"name@domain.eu"}))),generalError))}return null}}),LeaveDialog=React.createClass({displayName:"LeaveDialog",open:function(){this.refs.modal.open()},close:function(){this.refs.modal.close()},render:function(){var leaveButtonLabels={cancel:t("ui.cancel"),save:t("my.network.yes-i-want-to-leave")};return React.createElement(Modal,{ref:"modal",title:t("my.network.leave"),successHandler:this.props.onSubmit,buttonLabels:leaveButtonLabels},React.createElement("p",null,t("my.network.confirm-leave")))}}),InformationDialog=React.createClass({displayName:"InformationDialog",getInitialState:function(){return{organization:void 0}},open:function(){this.loadDCOrganizations()},close:function(){this.refs.modalModifyKAndDCOrg.close()},onError:function(srvErrCode,srvErrMessage){this.state.srvErrCode=srvErrCode,this.state.errMessage=srvErrMessage,403==srvErrCode&&(this.state.errMessage=t("error.datacore.forbidden")),this.setState(this.state),this.refs.modalOrgInfoError.open()},loadDCOrganizations:function(){this.props.org.dc_id&&$.ajax({url:network_service+"/search-organization-by-id",type:"get",contentType:"json",data:{dc_id:this.props.org.dc_id},success:function(data){data&&(data.inModification=!0,this.setState({organization:data}),this.refs.modalModifyKAndDCOrg.open(data))}.bind(this),error:function(xhr,status,err){}.bind(this)})},createOrModifOrg:function(event){return this.refs.tabbedFormModify.createOrModifOrg(event)},render:function(){var territoryId=this.props.org.territory_id?React.createElement("p",null,t("ui.location")," : ",this.props.org.territory_label):"",errorModal=React.createElement(Modal,{ref:"modalOrgInfoError",title:t("my.network.information"),infobox:!0,cancelHandler:null},React.createElement("br",null),React.createElement("div",null,React.createElement("h5",null,this.state.errMessage))),modal=void 0;if(this.state.organization)modal=React.createElement(CreateOrModifyOrganizationModal,{ref:"modalModifyKAndDCOrg",successHandler:this.props.onUpdate});else{var territoryId=this.props.org.territory_id?React.createElement("p",null,t("ui.location")," : ",this.props.org.territory_label):"";modal=React.createElement(Modal,{ref:"modalModifyKAndDCOrg",infobox:!0,buttonLabels:{ok:t("ui.close")},title:t("my.network.information")},React.createElement("h4",null,React.createElement("span",{title:this.props.org.id},this.props.org.name)),React.createElement("p",null,t("my.network.organization-type."+this.props.org.type)),territoryId,React.createElement("p",null,React.createElement("i",null,"No other information is available.")))}return React.createElement("div",null," ",modal," ",errorModal," ")}});React.render(React.createElement(MyNetwork,null),document.getElementById("mynetwork"));
