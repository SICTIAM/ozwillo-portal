var SearchOrganizationModal=React.createClass({displayName:"SearchOrganizationModal",componentDidMount:function(){$(this.getDOMNode()).modal({show:!1}),$(this.getDOMNode()).on("shown.bs.modal",function(){$("input#legal_name",this).focus()})},componentWillUnmount:function(){$(this.getDOMNode()).off("hidden")},close:function(event){$(this.getDOMNode()).modal("hide")},open:function(){$(this.getDOMNode()).modal("show"),this.refs.form.resetSearchVals()},openCreateOrModify:function(organization){this.close(),this.props.successHandler(organization)},render:function(){return React.createElement("div",{className:"modal fade"},React.createElement("div",{className:"modal-dialog modal-lg"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close",onClick:this.close},"×"),React.createElement("h3",null,t("search.organization.search-organization"))),React.createElement(SearchOrganizationForm,{ref:"form",successHandler:this.openCreateOrModify,cancelHandler:this.close}))))}}),SearchOrganizationForm=React.createClass({displayName:"SearchOrganizationForm",getInitialState:function(){return{country:"",country_uri:"",errors:[],searching:!1}},onCountryChange:function(country,country_uri){this.setState({country:country,country_uri:country_uri})},resetSearchVals:function(){this.refs.legal_name.getDOMNode().value="",this.refs.tax_reg_num.getDOMNode().value="",this.refs.sector_type_PUBLIC_BODY.getDOMNode().checked=!1,this.refs.sector_type_COMPANY.getDOMNode().checked=!1,this.refs.country.getUserCountry(),this.setState({errors:[]})},searchOrganization:function(event){if(event&&event.preventDefault(),!this.state.searching){var legal_name=this.refs.legal_name.getDOMNode().value.trim(),tax_reg_num=this.refs.tax_reg_num.getDOMNode().value.replace(/\s/g,""),sector_type="";this.refs.sector_type_PUBLIC_BODY.getDOMNode().checked?sector_type="PUBLIC_BODY":this.refs.sector_type_COMPANY.getDOMNode().checked&&(sector_type="COMPANY");var errors=[];this.state.country||errors.push("country"),legal_name||errors.push("legal_name"),tax_reg_num||errors.push("tax_reg_num"),""===sector_type&&errors.push("sector_type"),0==errors.length?(this.setState({searching:!0}),$.ajax({url:network_service+"/search-organization",type:"get",contentType:"json",data:{country:this.state.country,country_uri:this.state.country_uri,legal_name:legal_name,tax_reg_num:tax_reg_num,sector_type:sector_type},success:function(data){data?(this.setState({searching:!1}),this.props.successHandler(data)):this.setState({searching:!1,errors:["general"]})}.bind(this),error:function(xhr,status,err){this.setState({searching:!1,errors:["technical"]})}.bind(this)})):this.setState({errors:errors})}},renderLabel:function(htmlFor,class_name,label){var cn=-1!=$.inArray(class_name,this.state.errors)?"col-sm-3 control-label error":"col-sm-3 control-label";return React.createElement("label",{htmlFor:htmlFor,className:cn},label,React.createElement("label",{className:"error"}," *"))},renderSectorType:function(){if(this.state.country){var sectorTypeClassName="col-sm-3 control-label";return sectorTypeClassName=-1!=$.inArray("sector_type",this.state.errors)?sectorTypeClassName+" error":sectorTypeClassName,React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"organization-sector-type",className:sectorTypeClassName},t("search.organization.sector-type"),React.createElement("label",{className:"error"}," *")),React.createElement("div",{className:"col-sm-8"},React.createElement("label",{className:"radio-inline col-sm-3"},React.createElement("input",{type:"radio",value:"PUBLIC_BODY",ref:"sector_type_PUBLIC_BODY"},t("search.organization.sector-type.PUBLIC_BODY"))),React.createElement("label",{className:"radio-inline col-sm-3"},React.createElement("input",{type:"radio",value:"COMPANY",ref:"sector_type_COMPANY"},t("search.organization.sector-type.COMPANY")))))}},renderLegalName:function(){return this.state.country?React.createElement("div",{className:"form-group"},this.renderLabel("organization-name","legal_name",t("search.organization.legal-name")),React.createElement("div",{className:"col-sm-8"},React.createElement("input",{type:"text",id:"legal_name",className:"form-control",maxLength:"100",ref:"legal_name"}))):void 0},renderTaxRegNum:function(){if(this.state.country){var taxRegNumLabel="";switch(this.state.country){case"България":taxRegNumLabel=t("search.organization.business-id.bg");break;case"Italia":taxRegNumLabel=t("search.organization.business-id.it");break;case"France":taxRegNumLabel=t("search.organization.business-id.fr");break;case"España":taxRegNumLabel=t("search.organization.business-id.es");break;case"Türkiye":taxRegNumLabel=t("search.organization.business-id.tr");break;default:taxRegNumLabel=t("search.organization.business-id.en")}return React.createElement("div",{className:"form-group"},this.renderLabel("organization-business-id","tax_reg_num",taxRegNumLabel),React.createElement("div",{className:"col-sm-8"},React.createElement("input",{type:"text",className:"form-control",maxLength:"20",ref:"tax_reg_num"})))}},renderGeneralErrorMessage:function(){return-1!=$.inArray("general",this.state.errors)?React.createElement("label",{className:"error"},t("search.organization.cannot-be-used")):-1!=$.inArray("technical",this.state.errors)?React.createElement("label",{className:"error"},t("search.organization.technical-problem")):void 0},render:function(){return React.createElement("div",null,React.createElement("div",{className:"modal-body"},React.createElement("form",{onSubmit:this.searchOrganization,className:"form-horizontal"},React.createElement("div",{className:"form-group"},React.createElement("div",{className:"form-group"},this.renderLabel("organization-country-name","country",t("search.organization.country")),React.createElement("div",{className:"col-sm-5"},React.createElement(CountrySelect,{className:"form-control",ref:"country",url:store_service+"/dc-countries",onCountryChange:this.onCountryChange}))),this.renderLegalName(),this.renderTaxRegNum(),this.renderSectorType())),this.renderGeneralErrorMessage()),React.createElement("div",{className:"modal-footer"},React.createElement("button",{key:"cancel",className:"btn btn-default",onClick:this.props.cancelHandler},t("ui.cancel")),React.createElement("button",{key:"success",className:"btn btn-primary",onClick:this.searchOrganization},t("ui.search"))))}}),CountrySelect=React.createClass({displayName:"CountrySelect",propTypes:{url:React.PropTypes.string.isRequired},getInitialState:function(){return{countries:[],country_uri:""}},handleCountryChange:function(event){var country_uri=event.target.value,country=event.target.selectedOptions[0].label;this.setState({country_uri:country_uri}),this.props.onCountryChange(country,country_uri)},componentWillMount:function(){this.props.url&&$.ajax({url:this.props.url,type:"get",dataType:"json",data:{q:" "},success:function(data){for(var areas=data.areas.filter(function(n){return null!==n}),options=[{value:"",label:""}],i=0;i<areas.length;i++)options.push({value:areas[i].uri,label:areas[i].name});this.setState({countries:options}),this.getUserCountry()}.bind(this),error:function(xhr,status,err){}.bind(this)})},getUserCountry:function(){$.ajax({url:network_service+"/general-user-info",type:"get",contentType:"json",success:function(data){data.address&&(this.setState({country_uri:this.getValue(data.address.country)}),this.props.onCountryChange(data.address.country,this.getValue(data.address.country)))}.bind(this),error:function(xhr,status,err){}.bind(this)})},getValue:function(label){if(!label||""!==label)for(var i=0;i<this.state.countries.length;i++)if(this.state.countries[i].label===label)return this.state.countries[i].value;return null},render:function(){var options=this.state.countries.map(function(country,index){return React.createElement("option",{className:"action-select-option",key:index,value:country.value},country.label)});return React.createElement("select",{className:"btn btn-default dropdown-toggle",ref:"country",value:this.state.country_uri,onChange:this.handleCountryChange},options)}});
