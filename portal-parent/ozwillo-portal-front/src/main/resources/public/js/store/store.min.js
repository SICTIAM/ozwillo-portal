var AppStore=React.createClass({displayName:"AppStore",componentDidMount:function(){this.updateApps(!0,!0,!0,!0,!0)},getInitialState:function(){return{defaultApp:null,apps:[],loading:!0,maybeMoreApps:!1,filter:{audience:{citizens:!0,publicbodies:!0,companies:!0},payment:{paid:!0,free:!0}}}},mergeAppsWithDefaultAppFirst:function(){return this.state.defaultApp?$.merge([this.state.defaultApp],$.map(this.state.apps,function(app,i){return app.id!=this.state.defaultApp.id?app:void 0}.bind(this))):this.state.apps},updateApps:function(target_citizens,target_publicbodies,target_companies,paid,free){if(default_app)$.ajax({url:store_service+"/application/"+default_app.type+"/"+default_app.id,type:"get",dataType:"json",success:function(data){default_app=null;var state=this.state;state.defaultApp=data,state.defaultApp.isDefault=!0,this.setState(state)}.bind(this),error:function(xhr,status,err){}.bind(this)});else{var state=this.state;state.defaultApp=null,this.setState(state)}var supported_locales=[];"all"!==this.refs.sideBar.state.selectedLanguage&&supported_locales.push(this.refs.sideBar.state.selectedLanguage);var geoAreaAncestorsUris=this.refs.sideBar.state.geoAreaAncestorsUris,searchText=this.refs.sideBar.state.searchText,queryParams={target_citizens:target_citizens,target_publicbodies:target_publicbodies,target_companies:target_companies,free:free,paid:paid,supported_locales:supported_locales,geoArea_AncestorsUris:geoAreaAncestorsUris,category_ids:[],q:searchText};$.ajax({url:store_service+"/applications",data:queryParams,traditional:!0,type:"get",dataType:"json",success:function(data){this.setState({apps:data.apps,maybeMoreApps:data.maybeMoreApps,loading:!1,filter:{audience:{citizens:target_citizens,publicbodies:target_publicbodies,companies:target_companies},payment:{free:free,paid:paid}}})}.bind(this),error:function(xhr,status,err){this.setState({apps:[],loading:!1})}.bind(this)})},loadMoreApps:function(){var state=this.state;state.loading=!0,this.setState(state),$.ajax({url:store_service+"/applications",data:{last:this.state.apps.length,target_citizens:this.state.filter.audience.citizens,target_publicbodies:this.state.filter.audience.publicbodies,target_companies:this.state.filter.audience.companies,free:this.state.filter.payment.free,paid:this.state.filter.payment.paid},type:"get",dataType:"json",success:function(data){var state=this.state;state.apps=state.apps.concat(data.apps),state.loading=!1,state.maybeMoreApps=data.maybeMoreApps,this.setState(state)}.bind(this),error:function(data){var state=this.state;state.loading=!1,state.maybeMoreApps=!1,this.setState(state)}.bind(this)})},render:function(){var languagesAndAll=JSON.parse(JSON.stringify(languages));languagesAndAll.unshift("all");var initialSelectedLanguage=currentLanguage;return React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement(SideBar,{ref:"sideBar",currentLanguage:initialSelectedLanguage,languages:languagesAndAll,updateApps:this.updateApps,filter:this.state.filter}),React.createElement(AppList,{apps:this.mergeAppsWithDefaultAppFirst()})),React.createElement("div",{className:"row"},React.createElement(LoadMore,{loading:this.state.loading,maybeMoreApps:this.state.maybeMoreApps,loadMoreApps:this.loadMoreApps})))}}),SideBar=React.createClass({displayName:"SideBar",getInitialState:function(){return{selectedLanguage:"en",geoAreaAncestorsUris:[],searchText:""}},componentDidMount:function(){var s=this.state;s.selectedLanguage=this.props.currentLanguage,this.setState(s)},handleLanguageClicked:function(language){var s=this.state;s.selectedLanguage=language,this.setState(s),this.search()},fullTextSearchChanged:function(event){var s=this.state;s.searchText=event.target.value,this.setState(s)},search:function(event){var filter=this.props.filter;this.props.updateApps(filter.audience.citizens,filter.audience.publicbodies,filter.audience.companies,filter.payment.paid,filter.payment.free)},searchOnEnterDown:function(event){13===event.keyCode&&this.search(event)},onGeoChange:function(event){this.state.geoAreaAncestorsUris=event.added?event.added.ancestors:[],this.search(event)},change:function(category,item){return function(){var canChange=!1;for(var i in this.props.filter[category])if(i!=item&&this.props.filter[category][i]===!0){canChange=!0;break}if(canChange){var filter=this.props.filter;filter[category][item]=!filter[category][item],this.props.updateApps(filter.audience.citizens,filter.audience.publicbodies,filter.audience.companies,filter.payment.paid,filter.payment.free)}}.bind(this)},render:function(){var languageComponents=this.props.languages.map(function(language,i){return React.createElement("li",null,React.createElement("a",{onClick:this.handleLanguageClicked.bind(this,language),href:"#"},t(language)))}.bind(this));return React.createElement("div",{className:"col-md-4 sidebar"},React.createElement("h2",null,React.createElement("img",{src:image_root+"my/app-store.png"})," ",t("ui.appstore")),React.createElement("div",{className:"locale-filter"},React.createElement("span",null,t("languages-supported-by-applications")),React.createElement("div",{className:"btn-group"},React.createElement("button",{type:"button",className:"btn btn-sm btn-default dropdown-toggle","data-toggle":"dropdown","aria-expanded":"false"},React.createElement("span",null,t(this.state.selectedLanguage))," ",React.createElement("span",{className:"caret"})),React.createElement("ul",{className:"dropdown-menu",role:"menu"},languageComponents))),React.createElement("div",null,React.createElement("label",{htmlFor:"geoSearch",className:""},t("look-for-an-application"))),React.createElement("div",{className:"col-lg-13"},React.createElement("div",null,React.createElement(GeoSingleSelect2Component,{className:"form-control",ref:"geoSearch",onChange:this.onGeoChange,name:"geoSearch",urlResources:store_service+"/geographicalAreas",countryFilter:{country_uri:""}})),React.createElement("div",{className:"input-group"},React.createElement("input",{type:"text",className:"form-control",onChange:this.fullTextSearchChanged,onKeyDown:this.searchOnEnterDown,placeholder:t("keywords"),name:"fullTextSearch"}),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{className:"btn btn-default",type:"button",onClick:this.search},React.createElement("img",{className:"btn-search",src:"/img/icon/btn-search.png"}))))),React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:this.props.filter.audience.citizens,onChange:this.change("audience","citizens")}),t("citizens"))),React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:this.props.filter.audience.publicbodies,onChange:this.change("audience","publicbodies")}),t("publicbodies"))),React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:this.props.filter.audience.companies,onChange:this.change("audience","companies")}),t("companies"))),React.createElement("div",null),React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:this.props.filter.payment.free,onChange:this.change("payment","free")}),t("free"))),React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:this.props.filter.payment.paid,onChange:this.change("payment","paid")}),t("paid"))))},renderOldLanguageDropdown:function(){return React.createElement("div",{className:""},React.createElement("ul",{className:"nav navbar-nav"},React.createElement("li",{className:""},React.createElement("label",{htmlFor:"searchLocale",className:""},t("languages-supported-by-applications"))),React.createElement("li",{className:"dropdown dropdown-lang search-locale",name:"searchLocale"},React.createElement("a",{style:{color:"#636884",fontSize:"18px"},href:"#",className:"dropdown-toggle","data-toggle":"dropdown"},React.createElement("span",null,t(this.state.selectedLanguage)),React.createElement("i",{className:"caret"})),React.createElement("ul",{className:"dropdown-menu"},languageComponents))))}}),AppList=React.createClass({displayName:"AppList",render:function(){var apps=this.props.apps.map(function(app){return React.createElement(App,{key:app.id,app:app})}.bind(this));return React.createElement("div",{className:"col-md-8 app-store-result"},apps)}}),LoadMore=React.createClass({displayName:"LoadMore",render:function(){var loading=null;return this.props.loading?loading=React.createElement("div",{className:"text-center"},React.createElement("i",{className:"fa fa-spinner fa-spin"})," ",t("ui.loading")):this.props.maybeMoreApps&&(loading=React.createElement("div",{className:"text-center"},React.createElement("button",{className:"btn btn-primary",onClick:this.props.loadMoreApps},"Load more"))),React.createElement("div",{className:"col-md-8 col-md-offset-4"},loading)}}),App=React.createClass({displayName:"App",componentDidMount:function(){this.props.app.isDefault&&this.openApp()},openApp:function(){this.refs.appmodal.open()},render:function(){var indicatorStatus=this.props.app.installed?"installed":this.props.app.paid?"paid":"free",pubServiceIndicator=this.props.app.public_service?React.createElement("div",{className:"public-service-indicator"},React.createElement("div",{className:"triangle"}),React.createElement("div",{className:"label"},React.createElement("i",{className:"triangle fa fa-institution"}))):null;return React.createElement("div",null,React.createElement(AppModal,{ref:"appmodal",app:this.props.app}),React.createElement("div",{className:"hit text-center",onClick:this.openApp},pubServiceIndicator,React.createElement("img",{src:this.props.app.icon}),React.createElement("p",{className:"appname"},this.props.app.name),React.createElement("div",{className:"caption"},React.createElement("p",null,this.props.app.provider),React.createElement("p",{className:"appdescription"},this.props.app.description)),React.createElement(Indicator,{status:indicatorStatus})))}}),Indicator=React.createClass({displayName:"Indicator",render:function(){var btns,status=this.props.status;return btns="installed"==status?[React.createElement("button",{key:"indicator_button",className:"btn btn-indicator btn-indicator-installed"},t("installed")),React.createElement("button",{key:"indicator_icon",className:"btn btn-indicator btn-indicator-installed-icon"},React.createElement("i",{className:"fa fa-check"}))]:"free"==status?[React.createElement("button",{key:"indication_button",className:"btn btn-indicator btn-indicator-available"},t("free"))]:[React.createElement("button",{key:"indicator_button",className:"btn btn-indicator btn-indicator-available"},t("paid")),React.createElement("button",{key:"indicator_icon",className:"btn btn-indicator btn-indicator-available-icon"},React.createElement("i",{className:"fa fa-eur"}))],React.createElement("div",{className:"btn-group indicator"},btns)}});React.render(React.createElement(AppStore,null),document.getElementById("store"));
