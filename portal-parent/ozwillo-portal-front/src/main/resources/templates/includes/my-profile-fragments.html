<div data-th-fragment="layout (layout)">

  <div class="row" data-th-id="${layout.id}">
    <div class="col-sm-2 form-toggle-block">
        <button data-th-data="${layout.id}" type="button"
            data-th-class="'btn btn-form-toggle btn-view action-toggle-view' + ${'VIEW'.equals(layout.mode.toString()) ? ' active' : ''}" 
            data-th-text="#{${layout.label}}">Identity</button>
        <button data-th-data="${layout.id}" type="button"
            data-th-class="'btn btn-form-toggle btn-edit action-toggle-edit' + ${'EDIT'.equals(layout.mode.toString()) ? ' active' : ''}">
            <span class="edit"></span><span data-th-text="#{ui.edit}">Edit</span>
        </button>
    </div>
    <div class="col-sm-10 form-data-block">
    <form data-th-class="'form-horizontal ' + ${layout.formClass} + ${'EDIT'.equals(layout.mode.toString()) ? ' edit' : ''}"
          role="form" data-th-action="@{${layout.actionUrl}+'/'+${layout.id}}" data-th-data="${layout.id}"
          data-th-object="${modelObject}"
          method="post">
        <input type="hidden" data-th-name="${_csrf.parameterName}" data-th-value="${_csrf.token}"/>
        
      <div data-th-each="widget: ${layout.widgets}" class="form-group" data-th-classappend="${#fields.hasErrors('__${widget.id}__')}? 'has-error'">
          <label data-th-for="${widget.id}" class="col-sm-2 control-label" data-th-text="#{${widget.label}}">First name :</label>
          <div class="col-sm-10" data-th-if="${'text'.equals(widget.type)}"
                data-th-include="includes/my-profile-fragments :: text-widget (${widget.id}, ${modelObject.__${widget.id}__}, ${layout.mode})">?</div>
          <div class="col-sm-10" data-th-if="${'hidden'.equals(widget.type)}"
               data-th-include="includes/my-profile-fragments :: hidden-widget (${widget.id}, ${modelObject.__${widget.id}__}, ${layout.mode})">?</div>
          <div class="col-sm-10" data-th-if="${'dropdown'.equals(widget.type)}"
                data-th-include="includes/my-profile-fragments :: dropdown-widget (${widget}, ${modelObject.__${widget.id}__}, ${layout.mode})">?</div>
          <div class="col-sm-10" data-th-if="${'date'.equals(widget.type)}"
                data-th-include="includes/my-profile-fragments :: date-widget (${widget.id}, ${modelObject.__${widget.id}__}, ${layout.mode})">?</div>
          <div class="col-sm-10" data-th-if="${'avatar'.equals(widget.type)}"
                data-th-include="includes/my-profile-fragments :: avatar-widget (${widget}, ${modelObject.__${widget.id}__}, ${layout.mode})">?</div>
          <div class="col-sm-10" data-th-if="${'urlButton'.equals(widget.type)}"
                data-th-include="includes/my-profile-fragments :: urlButton-widget (${widget}, ${layout.mode})">?</div>
      </div>
      <div class="form-group" data-th-if="${'EDIT'.equals(layout.mode.toString())}">
        <label class="col-sm-2 control-label"></label>
        <div class="col-sm-10">
            <input type="submit" class="btn btn-save" data-th-value="#{ui.save}" />
        </div>
      </div>
    </form>
    
    <form role="form" data-th-action="@{'/media/objectIcon/'+${modelObject.userId}}" method="post" style="display: none">
        <input type="file" id="upload-avatar" name="upload-avatar" />
    </form>
    
    </div>
  </div>

</div>

<div data-th-fragment="text-widget (id, value, mode)">
    <span data-th-if="${'VIEW'.equals(mode.toString())}" class="form-value" data-th-text="${value}">?</span>
    <input data-th-if="${'EDIT'.equals(mode.toString())}" type="text" class="form-control" data-th-field="*{__${id}__}" />
    <!-- data-th-errorClass="form-control has-error" -->
    <span data-th-if="${#fields.hasErrors('__${id}__')}" data-th-errors="*{__${id}__}">Incorrect value</span>
</div>

<!-- used for select2 components -->
<div data-th-fragment="hidden-widget (id, value, mode)">
    <span data-th-if="${'VIEW'.equals(mode.toString())}" class="form-value" data-th-text="${value}">?</span>
    <input data-th-if="${'EDIT'.equals(mode.toString())}" type="hidden" class="form-control" data-th-field="*{__${id}__}" />
    <!-- data-th-errorClass="form-control has-error" -->
    <span data-th-if="${#fields.hasErrors('__${id}__')}" data-th-errors="*{__${id}__}">Incorrect value</span>
</div>

<div data-th-fragment="date-widget (id, value, mode)">
    <span data-th-if="${'VIEW'.equals(mode.toString())}" class="widget-date-view form-value" data-th-text="${value}"></span>
    <div data-th-if="${'EDIT'.equals(mode.toString())}" class="widget-date-edit">
        <input class="value-holder" type="hidden" data-th-id="${id} + '-value'" data-th-name="${id}" data-th-value="${value}" />
        <input class="form-control" type="text" data-th-name="${id}+'-localized'" data-th-value="${value}" />
    </div>
</div>

<div data-th-fragment="dropdown-widget (widget, value, mode)">
    <span data-th-if="${'VIEW'.equals(mode.toString())}" class="form-value" data-th-text="#{${widget.getOptionLabel('__${value}__')}}">?</span>
    <div data-th-if="${'EDIT'.equals(mode.toString())}" class="widget-dropdown">
        <input data-th-id="selected-option-__${widget.id}__" type="hidden" data-th-name="${widget.id}" data-th-value="${value}" />
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <span class="value-label" data-th-id="selected-option-__${widget.id}__-label" data-th-text="#{${widget.getOptionLabel('__${value}__')}}">English</span>
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu" aria-labelledby="language-label">
            <li data-th-each="option : ${widget.options}">
                <a data-th-id="option-__${widget.id}__-__${option.key}__" class="action-select-option" data-th-data="${option.key}" href="#" data-th-text="#{${option.value}}">Blablaish</a>
            </li>
        </ul>
    </div>
</div>

<div data-th-fragment="avatar-widget (widget, value, mode)">

  	<div class="col-md-12 avatar-block">
  		<input id="selected-avatar" type="hidden" data-th-field="*{__${widget.id}__}" />
      	<img id="selected-avatar-image" class="avatar" data-th-src="${value}" data-th-style="${#strings.isEmpty(value)?'display:none':''}" />
      	<div id="empty-avatar-label" class="avatar empty" data-th-style="${!#strings.isEmpty(value)?'display:none':''}" data-th-text="#{my.profile.account.noavatar}">No avatar</div>
       	<button id="btn-edit-avatar" class="btn btn-edit" type="button" data-th-attr="disabled=${'VIEW'.equals(mode.toString())}">
      		<span class="edit"></span><span data-th-text="#{my.profile.account.changeavatar}">Change avatar</span>
      	</button>
        <button id="btn-upload-avatar" class="btn btn-edit" type="button" data-th-style="${'VIEW'.equals(mode.toString())?'display:none':''}">
      		<span class="edit"></span><span data-th-text="#{my.profile.account.uploadavatar}">Upload file...</span>
      	</button>
        <button id="btn-remove-avatar" class="btn btn-remove" type="button" data-th-if="${!#strings.isEmpty(value) and 'EDIT'.equals(mode.toString())}">
            <span class="remove"></span><span data-th-text="#{ui.remove}">Remove</span>
        </button>
  	</div>

    <div id="modal-avatar-upload-failure" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" data-th-text="#{my.profile.account.uploadfailure.title}"></div>
                <div class="modal-body" data-th-text="#{my.profile.account.uploadfailure.message}"></div>
                <div class="modal-footer">
                   <button type="button" class="btn btn-default" data-dismiss="modal" data-th-value="#{ui.cancel}">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-edit-avatar" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
     <div class="modal-dialog">
       <div class="modal-content">
         <div class="modal-header">
           <button type="button" class="close" data-dismiss="modal">
                <span aria-hidden="true">&times;</span>
                <span class="sr-only">Close</span>
           </button>
           <h4 class="modal-title" data-th-text="#{my.profile.account.changeavatar}">Change avatar</h4>
         </div>
             <div class="modal-body">
                 <div class="btn-avatar-group">
        			<img data-th-each="availableAvatar: ${widget.availableAvatars}" 
        			data-th-class="'btn-avatar action-select-avatar ' + ${availableAvatar.equals(value) ? 'selected' : ''}" 
        			data-th-src="${availableAvatar}" />
    			</div>
             </div>
             
             <div class="modal-footer">
               <button type="button" class="btn btn-default" data-dismiss="modal" data-th-value="#{ui.cancel}">Cancel</button>
             </div>
       </div>
     </div>
   </div>
</div>

<div data-th-fragment="urlButton-widget (widget, mode)">

  	<div class="col-md-2 avatar-block">
        <a data-th-href="@{${widget.url}}">
            <button id="btn-edit-password" class="btn btn-edit" type="button"
                    data-th-attr="disabled=${'VIEW'.equals(mode.toString())}">
      		<span class="edit"></span><span data-th-text="#{${widget.buttonLabel}}">Change password</span>
      	</button></a>
  	</div>
</div>
